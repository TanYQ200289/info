import{z as e,o as a,c as l,w as t,a as u,b as n,t as s,$ as o,Z as r,N as i,i as c,J as d,e as f,a1 as v,a2 as m}from"./index.37bf5aad.js";import{u as p}from"./index.675729df.js";import{_}from"./plugin-vue_export-helper.21dcd24c.js";var g=_({__name:"Login",setup(_){const g=e(null),b=e(60),x=e(!0),h=e(""),y=p();function I({detail:{value:e}}){/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/.test(e.cellphoneNumber)?async function(e,a){const l=await uni.Http(`/user/login/${e}/${a}`,"get");404===l.statusCode?o({title:"登录失败",icon:"error",duration:2e3}):"验证码已失效"===l.data||"验证码错误"===l.data?(o({title:"验证码错误或者失效",icon:"error",duration:2e3}),a.value=60,x.value=!0):(y.userInfo=l.data,r("user",JSON.stringify(y.userInfo)),i({url:"/pages/My/My"}))}(e.cellphoneNumber,e.exam):o({title:"请输入正确手机号码",icon:"error"})}function N(){0!==h.value.trim().length?g.value||(x.value=!1,async function(){const e=h.value,{data:a}=await uni.Http(`/user/sendMessage/${e}`,"get");"验证码发送成功"!==a&&o({title:"获取验证码失败",icon:"error"})}(),g.value=setInterval((()=>{if(0===b.value)return clearInterval(g.value),g.value=null,x.value=!0,void(b.value=60);b.value--}),1e3)):o({title:"请输入手机号码",icon:"error"})}return(e,o)=>{const r=c,i=d,p=f,_=v,g=m;return a(),l(r,{class:"login-content"},{default:t((()=>[u(r,{class:"login-title-box"},{default:t((()=>[u(r,null,{default:t((()=>[n("手机号登录")])),_:1}),u(r,null,{default:t((()=>[n("未注册的手机号登录后将自动注册")])),_:1})])),_:1}),u(r,{class:"form-box"},{default:t((()=>[u(g,{onSubmit:I},{default:t((()=>[u(r,{class:"cellphone"},{default:t((()=>[u(i,{name:"cellphoneNumber",modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=e=>h.value=e),placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),u(r,{class:"exam"},{default:t((()=>[u(i,{name:"exam",placeholder:"请输入验证码"}),u(p,{onClick:N},{default:t((()=>[n(s(x.value?"获取验证码":b.value),1)])),_:1})])),_:1}),u(_,{class:"button-class","form-type":"submit"},{default:t((()=>[n("登录")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-8f0a1c34"]]);export{g as default};
